<!DOCTYPE html>
<html>
<head>
    <title>Rest Client</title>
	<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link href="../Content/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../Content/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />

    <!-- jQuery -->
    <script src="../Scripts/jquery-2.1.4.js"></script>

    <!-- Bootstrap JS -->
    <script src="../Scripts/bootstrap.min.js"></script>

    <style>
        .bs-example {
            margin:20px;
        }
    </style>

    <script>

        $(function () {

            console.log("DOM ready.");


            $("#createbtn").on("click", createData);
            $("#readbtn").on("click", readData);
        });


        function createData() {
            $("#contentarea").load("create.html", function () {
                console.log("loaded partialview 'create.html' successfully...")
                $("#createDataBtn").on("click", createDataRequest);
            });

 
        }
        function readData() {

            // Load Table HTML Template
            $("#contentarea").load("read.html", function (response, status, xhr) {

                if (status == "error") {

                    $("#container").empty().html("Error: " + xhr.status + " " + xhr.statusText);
                    return;
                }

                // Load Table Data
                var restUrl = window.location.origin;
                console.log("REStful WCLF Service Base URL: " + restUrl);

                var value = "73";
                var readUrl = restUrl + "/RESTfulService.svc/Data/" + value;


                $.ajax({
                    type: "GET",
                    url: readUrl,
                    contentType: "json",
                    dataType: "json",
                    success: function (data) {

                        console.log(data);

                        var $table = $('#dataTable');
                        var $tableBody = $table.find('tbody');

                        $.each(data, function (index, item) {

                            var id = item.Id;
                            var boolValue = item.BoolValue;
                            var stringValue = item.StringValue;

                            var htmlTableRow =
                                "<tr>" +
                                "<td>" + boolValue + "</td>" +
                                    "<td>" + stringValue + "</td>" +
                                    "<td>" +
                                        "<div class=\"btn-toolbar\">" +
                                            "<div class=\"btn-group\">" +
                                                "<button type=\"button\" class=\"btn btn-primary disabled\" id=\"updatebtn\" data-id=\"" + id + "\">Edit</button>" +
                                                "<button type=\"button\" class=\"btn btn-primary\" id=\"deletebtn\" data-id=\"" + id + "\">Delete</button>" +
                                            "</div>" +
                                        "</div>" +
                                    "</td>" +
                                "</tr>";

                            var $addedRow = $(htmlTableRow);

                            $tableBody.append($addedRow);

                            // add event handler
                            var $updateBtn = $addedRow.find("#updatebtn");
                            var $deleteBtn = $addedRow.find("#deletebtn");

                            $updateBtn.on("click", updateData);
                            $deleteBtn.on("click", deleteData);
                        });
                    },
                    error: function (xhr) {
                        alert(xhr.responseText);
                    }
                });
            });
        }
        function updateData() {
            alert("Not implemented yet.");
        }
        function deleteData() {
            $this = $(this);
            var id = $this.data("id");

            var restUrl = window.location.origin;
            console.log("REStful WCLF Service Base URL: " + restUrl);

            var deleteUrl = restUrl + "/RESTfulService.svc/DeleteData/" + id;

            $.ajax({
                type: "DELETE",
                url: deleteUrl,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    var result = data ? "Success on data delete." : "No entity found for given Id.";

                    console.log(result);

                    // Reload table data
                    readData();
                },
                error: function (xhr) {
                    alert("Error occured on data delete attempt.\nMessage: " + xhr.status + " " + xhr.statusText)
                }
            });

        }

        function createDataRequest() {
            
            var boolValue = $("#boolValue").is(":checked");
            var stringValue = $("#stringValue").val();

            var composite = {
                "BoolValue": boolValue,
                "StringValue": stringValue
            };

            var stringifiedData = JSON.stringify(composite);

            var restUrl = window.location.origin;
            console.log("REStful WCLF Service Base URL: " + restUrl);

            var createUrl = restUrl + "/RESTfulService.svc/AddData/";

            $.ajax({
                type: "PUT",
                url: createUrl,
                data: stringifiedData,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                processData: true,
                success: function (data, status, jqXHR) {
                    console.log("Success on data create.");

                    // Reload table data
                    readData();
                },
                error: function (xhr) {
                    console.log("Error occured on data create. Message: " + xhr.status + " " + xhr.statusText);
                    $("#errorcreate").empty().html(xhr.responseText);
                }

            });

        }

    </script>
</head>
<body>

    <div class="container">

        <!-- Top Row -->
        <div class="row">
            <div class="col-sm-12">
                <div class="bs-example">
                    <div class="btn-toolbar">
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary" id="readbtn">GetData(Json)</button>
                            <button type="button" class="btn btn-primary disabled">GetData(XML)</button>                        
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary" id="createbtn">AddData(Json)</button>
                            <button type="button" class="btn btn-primary disabled">AddData(XML)</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Bottom Row -->
        <div class="row">
            <div class="col-sm-12" id="contentarea">

            </div>
        </div>

    </div>
</body>
</html>
